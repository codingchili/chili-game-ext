<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/paper-material/paper-material.html">
<link rel="import" href="../../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../../bower_components/polymer/lib/mixins/gesture-event-listeners.html">
<link rel="import" href="../../../bower_components/paper-tooltip/paper-tooltip.html">

<link rel="import" href="./player-status.html">

<!--
    @author Robin Duda
    Realm chat.
 -->

<dom-module id="party-view">
    <link rel="import" href="../../style/theme.css" type="css">
    <link rel="import" href="../../style/style.css" type="css">
    <template>
        <style>
            :host {
            }

            .container {
                position: absolute;
                top: 12%;
                left: 32px;
                display: flex;
                flex-direction: column;
                z-index: 400;
            }

            .member {
                position: relative;
                margin-bottom: 16px;
                top: 0;
                left: 0;
            }

        </style>

        <div class="container">
            <template is="dom-repeat" items="[[members]]" as="member">
                <player-status target="[[member]]" class="member" style$="[[_index(index)]]"
                               compact></player-status>
            </template>
        </div>

    </template>
    <script>
        class PartyView extends Polymer.GestureEventListeners(Polymer.Element) {

            static get is() {
                return 'party-view';
            }

            constructor() {
                super();
                this.members = [];
                this.target = false;


                application.onRealmLoaded(realm => {
                    this.realm = realm;
                });

                application.onGameLoaded(() => {
                    game.subscribe('character-update', target => {
                        if (!this.target) {
                            this.target = target;
                            this.members = [this.target, this.target, this.target];
                        }
                    });
                });
            }

            _index(index) {
                return `z-index: ${10 - index};`;
            }

            _loaded() {
                return (typeof this.realm !== 'undefined');
            }

            _inventory() {
                application.publish('show-inventory');
            }

            _quests() {
                application.publish('show-quests');
            }

            _settings() {
                application.publish('show-settings');
            }

            _characters(e) {
                game.shutdown();
                application.scriptShutdown();
                application.showCharacters();
            }
        }

        window.customElements.define(PartyView.is, PartyView);
    </script>
</dom-module>