<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/paper-material/paper-material.html">
<link rel="import" href="../../../bower_components/polymer/lib/mixins/gesture-event-listeners.html">

<!--
    @author Robin Duda
    Realm chat.
 -->

<dom-module id="loot-dialog">
    <link rel="import" href="../../style/theme.css" type="css">
    <link rel="import" href="../../style/style.css" type="css">
    <template>
        <style>
            :host {
            }

            #dialog {
                pointer-events: auto;
                position: absolute;
                left: 50%;
                top: 50%;
                transform: translate(-50%, -50%);
                min-width: 428px;
                max-width: 428px;
                z-index: 999;
            }

            .interface-box {
                background-color: #000000;
                opacity: 1;
            }

            span {
                padding: 0.28rem;
            }

            .dialog-entity {
                margin-top: 8px;
                padding-left: 16px;
                display: block;
                color: var(--paper-grey-300);
            }

            #dialog-close:hover {
                color: var(--player-class-theme);
            }

            #dialog-close {
                position: absolute;
                right: 8px;
                top: 8px;
            }

            @keyframes fadein {
                from {
                    opacity: 0;
                }
                to {
                    opacity: 0.64;
                }
            }

            #loot-container {
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                position: absolute;
                display: none;
                pointer-events: all;
                z-index: 500;
            }

            #overlay {
                width: 100%;
                height: 100%;
                z-index: 500;
                background-color: black;
                opacity: 0.64;
                animation: fadein 1.2s ease 1;
                pointer-events: none;
            }
        </style>

        <div id="loot-container">
            <div id="overlay"></div>

            <paper-material elevation="3" class="interface-box" id="dialog">
                <iron-icon icon="icons:close" id="dialog-close" on-down="_stop"></iron-icon>

                <span class="dialog-entity">[[target.name]]</span>

                <template is="dom-repeat" items="[[loot]]" as="item">
                    <div>[[item.name]]</div>
                </template>

            </paper-material>
        </div>
    </template>
    <script>
        class LootDialog extends Polymer.GestureEventListeners(Polymer.Element) {

            static get is() {
                return 'loot-dialog';
            }

            ready() {
                super.ready();

                server.connection.setHandler('loot_list', e => {
                    this.set('target', game.entities[e.targetId]);
                    this.set('loot', e.lootList);
                    this._start();
                });
            }

            _start() {
                this.$['loot-container'].style.display = 'block';
            }

            _stop() {
                this.$['loot-container'].style.display = 'none';
                game.inventory.unsubscribeLootList(this.target);
            }
        }

        window.customElements.define(LootDialog.is, LootDialog);
    </script>
</dom-module>