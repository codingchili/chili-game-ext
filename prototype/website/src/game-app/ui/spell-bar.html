<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/paper-material/paper-material.html">
<link rel="import" href="../../../bower_components/paper-tooltip/paper-tooltip.html">

<!--
    @author Robin Duda
    Realm chat.
 -->

<dom-module id="spell-bar">
    <link rel="import" href="../../style/theme.css" type="css">
    <link rel="import" href="../../style/style.css" type="css">
    <template>
        <style>
            :host {
                position: absolute;
                bottom: 16px;
                left: 50%;
                transform: translateX(-50%);
            }

            .interface-box {
                left: -50%;
                display: block;
                background-color: #000000;
                opacity: 0.84;
                height: 46px;
            }

            .spell-icon {
                height: 42px;
                padding-left: 4px;
                padding-right: 4px;
            }

            .cooldown-bar {
                --paper-progress-active-color: #4db6ac;
                --paper-progress-container-color: #4db6ac32;
                width: 42px;
                margin-left: 4px;
                position: absolute;
                top: 40px;
            }

            .title {
                font-size: 2.0em;
            }

            .description {
                margin-top: 12px;
                display: block;
                font-size: larger;
            }

            .target {
                color: #00b0ff;
            }

            .cooldown {
                color: #00b0ff;
            }

            .casttime {
                color: #00b0ff;
            }

            .spell-info {
                width: 246px;
            }

            .info-table {
                margin-top: 12px;
                width: 100%;
            }

            @media (max-width: 632px) {
                :host {
                    bottom: 48px;
                }
            }

        </style>

        <paper-material elevation="3" class="interface-box">
            <template is="dom-repeat" items="{{spells}}" as="spell">
                <template is="dom-if" if="{{_learned(spell)}}">
                    <div on-click="_cast">
                        <img class="spell-icon" src="[[realm.resources]]/gui/spell/[[spell.id]].svg">
                        <paper-tooltip class="spell-info" animation-delay="0" position="top">
                            <span class="title">[[spell.id]]</span>

                            <table class="info-table">
                                <tr>
                                    <th>Cooldown</th>
                                    <th>Cast</th>
                                    <th>Target</th>
                                </tr>
                                <tr style="text-align: center;">
                                    <td class="cooldown">[[spell.cooldown]]s</td>
                                    <td class="casttime">[[spell.casttime]]s</td>
                                    <td class="target">[[spell.target]]</td>
                                </tr>
                            </table>

                            <span class="description">{{_description(spell)}}</span>

                        </paper-tooltip>
                    </div>

                    <!-- cooldown, hide otherwise. -->
                    <paper-progress class="cooldown-bar transiting" min="0" max="[[character.stats.nextlevel]]"
                                    value="[[character.stats.experience]]"></paper-progress>
                </template>
            </template>
        </paper-material>

    </template>
    <script>
        class SpellBar extends Polymer.Element {

            static get is() {
                return 'spell-bar';
            }

            constructor() {
                super();

                this.spells = [{"id": "hello"}];

                setInterval(() => {
                    this.spells = application.realm.spells;
                    this.character = application.character;
                    this.set("realm", application.realm);
                    this.set("spells", application.realm.spells);
                    this.notifyPath("realm");
                    this.notifyPath("spells");
                    this.notifySplices("spells");
                }, 1000);
            }

            _description(spell) {
                // ?
                return eval('`' + spell.description + "`");
            }

            _cast(event) {
                server.cast((casted) => {
                    console.log(casted);
                }, event.model.spell.id, {});
            }

            _learned(spell) {
                return this.character.spells.learned.indexOf(spell.id) >= 0;
            }
        }

        window.customElements.define(SpellBar.is, SpellBar);
    </script>
</dom-module>